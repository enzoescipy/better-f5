# Better-F5 Specification

## 1. 개요

macOS 환경에서 F5 키를 사용하여 음성 입력을 시작/중지하고, 변환된 텍스트를 클립보드에 저장하는 백그라운드 애플리케이션입니다. `faster-whisper`를 로컬에서 사용하여 빠르고 효율적인 음성-텍스트 변환을 제공합니다.

## 2. 기술 스택

- **언어:** Python 3.x
- **애플리케이션 프레임워크:** `rumps` (macOS 메뉴 막대 앱)
- **전역 단축키 감지:** `pynput`
- **오디오 녹음:** `sounddevice`
- **음성-텍스트 변환 (STT):** `faster-whisper` (로컬 Whisper 모델, base 모델 사용 예정)
- **클립보드 제어:** `pyperclip`
- **패키징 (선택 사항):** `py2app` 또는 `pyinstaller` (독립 실행형 앱 배포 시)

## 3. 동시성 처리

- **필요성:** 오디오 녹음 (`sounddevice`) 및 음성-텍스트 변환 (`faster-whisper`) 작업은 시간이 소요될 수 있습니다. 이러한 작업이 메인 스레드에서 실행되면 메뉴 막대 앱 (`rumps`)의 UI가 멈추는 현상이 발생하여 사용자 경험을 저해합니다.
- **접근 방식:** Python의 `threading` 모듈을 사용하여 시간이 오래 걸리는 작업을 별도의 스레드에서 처리합니다. 이를 통해 메인 스레드는 항상 사용자 입력 및 UI 업데이트에 응답할 수 있도록 유지합니다.

## 4. 상세 워크플로우

### 4.1 애플리케이션 시작 시

1.  `rumps` 애플리케이션 시작.
2.  메뉴 막대에 기본 아이콘 표시 (예: 마이크).
3.  `pynput`을 사용하여 F5 키 감지 리스너를 백그라운드 스레드에서 시작.
4.  `faster-whisper` 모델 로드 준비 (선택적: 초기 로딩).

### 4.2 F5 키 첫 번째 누름 (녹음 시작)

1.  `pynput`이 F5 키 감지.
2.  현재 상태가 '녹음 중'이 아닌지 확인.
3.  상태를 '녹음 중'으로 변경.
4.  **피드백:** 메뉴 막대 아이콘 변경 (예: 녹음 중 표시).
5.  별도 **녹음 스레드** 시작:
    *   `sounddevice`로 오디오 입력 시작.
    *   오디오 데이터 버퍼링/임시 저장.

### 4.3 F5 키 두 번째 누름 (녹음 중지 및 처리)

1.  `pynput`이 F5 키 감지.
2.  현재 상태가 '녹음 중'인지 확인.
3.  상태를 '처리 중'으로 변경.
4.  **녹음 스레드**에 중지 신호 전송 및 종료 대기.
5.  **피드백:** 메뉴 막대 아이콘 변경 (예: 처리 중 표시).
6.  별도 **처리 스레드** 시작:
    *   녹음된 오디오 데이터 가져오기.
    *   `faster-whisper`로 STT 수행.
7.  **처리 스레드** 완료 시:
    *   변환된 텍스트를 메인 스레드로 전달.
    *   메인 스레드에서 `pyperclip`으로 클립보드 복사.
    *   상태를 '대기 중'으로 변경.
    *   **피드백:** 메뉴 막대 아이콘 기본 상태로 복원.
    *   (선택 사항) 완료 알림 표시.

### 4.4 오류 발생 시

*   **녹음 실패:** 사용자 알림 표시, 상태 '대기 중' 리셋.
*   **변환 실패:** 사용자 알림 표시, 상태 '대기 중' 리셋.
*   **클립보드 복사 실패:** 사용자 알림 표시.

### 4.5 애플리케이션 종료

1.  사용자가 메뉴에서 '종료' 선택.
2.  `pynput` 리스너 스레드 안전하게 종료.
3.  리소스 정리.
4.  `rumps` 애플리케이션 종료. 